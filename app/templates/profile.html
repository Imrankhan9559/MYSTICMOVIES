{% extends "base.html" %}
{% block content %}
<section class="space-y-6">
    <div class="rounded-2xl border border-gray-800 bg-gradient-to-br from-gray-950 to-black p-5 sm:p-7">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
            <div>
                <p class="text-xs uppercase tracking-[0.22em] text-yellow-400">My Profile</p>
                <h1 class="text-2xl sm:text-3xl font-extrabold text-white mt-1">{{ user.first_name or "User" }}</h1>
                <p class="text-sm text-gray-400 mt-1">{{ user.phone_number }}</p>
                {% if is_admin %}
                <span class="inline-flex mt-3 px-2.5 py-1 rounded-full border border-red-700 bg-red-900/40 text-[11px] text-red-300 uppercase">Admin</span>
                {% endif %}
            </div>
            <div class="grid grid-cols-2 gap-3 sm:w-auto w-full">
                <div class="rounded-xl border border-gray-700 bg-black/70 px-4 py-3 text-center">
                    <div class="text-xl font-bold text-white">{{ watchlist_cards|length }}</div>
                    <div class="text-[11px] text-gray-500 uppercase">Watchlist</div>
                </div>
                <div class="rounded-xl border border-gray-700 bg-black/70 px-4 py-3 text-center">
                    <div class="text-xl font-bold text-white">{{ continue_cards|length }}</div>
                    <div class="text-[11px] text-gray-500 uppercase">Continue Watching</div>
                </div>
            </div>
        </div>
        <div class="mt-4">
            <a href="/logout" class="inline-flex items-center rounded-lg border border-gray-700 bg-black/70 px-3 py-2 text-xs text-gray-300 hover:border-yellow-500 hover:text-yellow-300">
                <i class="fas fa-sign-out-alt mr-2"></i>Logout
            </a>
        </div>
    </div>

    <div class="rounded-2xl border border-gray-800 bg-gray-950 p-5 sm:p-7">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-white">Watchlist</h2>
            <a href="/content" class="text-sm text-yellow-300 hover:text-yellow-200">Browse</a>
        </div>
        {% if watchlist_cards %}
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4">
            {% for c in watchlist_cards %}
            <a href="/content/details/{{ c.slug or c.id }}" class="group rounded-xl border border-gray-800 bg-black/70 overflow-hidden hover:border-yellow-500/60 transition">
                <div class="aspect-[2/3]">
                    {% if c.poster %}
                    <img src="{{ c.poster }}" alt="{{ c.title }}" class="h-full w-full object-cover">
                    {% else %}
                    <div class="h-full w-full bg-gradient-to-br from-gray-900 via-black to-gray-800 flex items-center justify-center">
                        <i class="fas fa-film text-yellow-400 text-3xl"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="p-2.5">
                    <div class="text-sm font-semibold text-white truncate">{{ c.title }}</div>
                    <div class="text-xs text-gray-500">{{ c.year or "-" }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="rounded-xl border border-gray-800 bg-black/80 p-4 text-sm text-gray-500">No items in watchlist yet.</div>
        {% endif %}
    </div>

    <div class="rounded-2xl border border-gray-800 bg-gray-950 p-5 sm:p-7">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-xl font-bold text-white">Continue Watching</h2>
            <span class="text-xs text-gray-500">{{ continue_cards|length }} items</span>
        </div>
        {% if continue_cards %}
        <div class="flex gap-4 overflow-x-auto pb-1">
            {% for c in continue_cards %}
            <a href="/player/{{ c.item_id }}" class="min-w-[220px] max-w-[220px] rounded-xl border border-gray-800 bg-black/80 overflow-hidden hover:border-yellow-500/60 transition">
                <div class="aspect-video">
                    {% if c.poster %}
                    <img src="{{ c.poster }}" alt="{{ c.title }}" class="h-full w-full object-cover">
                    {% else %}
                    <div class="h-full w-full bg-gray-900 flex items-center justify-center">
                        <i class="fas fa-play text-yellow-400"></i>
                    </div>
                    {% endif %}
                </div>
                <div class="p-3">
                    <div class="text-sm text-white font-semibold truncate">{{ c.title }}</div>
                    <div class="text-xs text-gray-500 mt-1">{{ c.remaining }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="rounded-xl border border-gray-800 bg-black/80 p-4 text-sm text-gray-500">No in-progress videos.</div>
        {% endif %}
    </div>

    <div class="rounded-2xl border border-gray-800 bg-gray-950 p-5 sm:p-7">
        <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-bold text-white">Watch History</h2>
            <span class="text-xs text-gray-500">Recent activity</span>
        </div>
        {% if history_rows %}
        <div class="space-y-3">
            {% for h in history_rows %}
            <a href="/content/details/{{ h.slug or h.item_id }}" class="flex items-center gap-3 rounded-xl border border-gray-800 bg-black/80 p-3 hover:border-yellow-500/50 transition">
                <div class="h-14 w-10 rounded overflow-hidden border border-gray-700 bg-gray-900 shrink-0">
                    {% if h.poster %}
                    <img src="{{ h.poster }}" alt="{{ h.title }}" class="h-full w-full object-cover">
                    {% else %}
                    <div class="h-full w-full flex items-center justify-center"><i class="fas fa-film text-yellow-400 text-xs"></i></div>
                    {% endif %}
                </div>
                <div class="min-w-0 flex-1">
                    <div class="text-sm text-white font-semibold truncate">{{ h.title }}</div>
                    <div class="text-xs text-gray-500">{{ h.remaining }}</div>
                </div>
            </a>
            {% endfor %}
        </div>
        {% else %}
        <div class="rounded-xl border border-gray-800 bg-black/80 p-4 text-sm text-gray-500">No watch history yet.</div>
        {% endif %}
    </div>
</section>
{% endblock %}
